class e{static replaceRange(e,t,n,s){return e.substring(0,t)+s+e.substring(n)}}class t{}class n extends t{transform(t,n){const s=t.matchAll(/--[\w-]+(?=\s*: ?.+;)/g);let r=0;for(const o of s){const s=o[0],a=o.index-r,i=n.transform(s),l=e.replaceRange(t,a,a+s.length,`--${i}`);r+=t.length-l.length,t=l}return t}}class s{}class r extends s{transform(t,n){const s=t.matchAll(/(?<="|')--[\w-]+(?=\\?\"|')/g),r=t.matchAll(/(?<=var\()[^()]*(?:\([^\)]*\)[^()]*)*(?=\))/g);let o=0;for(const r of s){const s=r[0],a=r.index-o,i=e.replaceRange(t,a,a+s.length,n.CSSVariableOf(s));o+=t.length-i.length,t=i}for(const s of r){const r=s[0].matchAll(/--[\w-]+/g),a=s.index;for(const s of r){const r=s[0],i=a+s.index-o,l=e.replaceRange(t,i,i+r.length,n.CSSVariableOf(r));o+=t.length-l.length,t=l}}return t}}class o{constructor(){this.count=0,this.cache=new Map}createName(e=this.count++){let t="",n=o.chars.length;for(;e>=0&&(t=o.chars[e%n]+t,e>0);)e=Math.floor(e/n)-1;return t}transform(e){let t=this.cache.get(e);return t?(t.referenceCount+=1,t.identifierName):(this.cache.set(e,{originalName:e,identifierName:this.createName(),referenceCount:0}),this.cache.get(e).identifierName)}CSSVariableOf(e){return this.cache.get(e)?`--${this.transform(e)}`:e}printLogs(){console.log(this.cache)}printLogsUnused(){for(const e of this.cache.values())0==e.referenceCount&&console.log(`${e.originalName} is not referenced.`)}}o.chars="abcdefghijklmnopqrstuvwxyz";class a{constructor(e){var t,s;this.options=e,this.transpilers=[],(null===(s=null===(t=null==e?void 0:e.mangle)||void 0===t?void 0:t.variable)||void 0===s||s)&&this.transpilers.push({declaration:new n,reference:new r,mangler:new o})}apply(e){var t,n;const s=!(null!==(n=null===(t=this.options)||void 0===t?void 0:t.ignoreScript)&&void 0!==n&&n);e.hooks.compilation.tap("CSSMangleWebpackPlugin",(t=>{t.hooks.processAssets.tap({name:"CSSMangleWebpackPlugin",stage:e.webpack.Compilation.PROCESS_ASSETS_STAGE_OPTIMIZE},(n=>{var r,o,a,i;for(const r in n)if(r.endsWith(".html")||r.endsWith(".js")&&s||r.endsWith(".jsx")&&s||r.endsWith(".css"))for(const s of this.transpilers){const o=n[r].source().toString(),a=s.declaration.transform(o,s.mangler),i=s.reference.transform(a,s.mangler);t.updateAsset(r,new e.webpack.sources.RawSource(i))}null!==(o="all"==(null===(r=this.options)||void 0===r?void 0:r.printLogs))&&void 0!==o&&o&&this.transpilers.forEach((e=>e.mangler.printLogs())),null!==(i="warning"==(null===(a=this.options)||void 0===a?void 0:a.printLogs))&&void 0!==i&&i&&this.transpilers.forEach((e=>e.mangler.printLogsUnused()))}))}))}}export{n as CSSVariableDeclaration,r as CSSVariableReference,o as Mangler,t as ManglerDeclaration,s as ManglerReference,a as default};
