class e{constructor(){this.count=0,this.cache=new Map}createIdentifierName(t=this.count++){let r="",n=e.chars.length;for(;t>=0&&(r=e.chars[t%n]+r,t>0);)t=Math.floor(t/n)-1;return r}transform(e){let t=this.cache.get(e);return t?(t.referenceCount+=1,t.identifierName):(this.cache.set(e,{originalName:e,identifierName:this.createIdentifierName(),referenceCount:0}),this.cache.get(e).identifierName)}get unused(){return Array.from(this.cache.values()).filter((e=>0==e.referenceCount))}CSSVariableOf(e){return this.cache.get(e)?`--${this.transform(e)}`:null}printLogs(){console.log(this.cache)}printLogsUnused(){for(const e of this.unused)console.log(`${e.originalName} is not referenced.`)}}e.chars="abcdefghijklmnopqrstuvwxyz";class t{static replaceRange(e,t,r,n){return e.substring(0,t)+n+e.substring(r)}static replacedLength(e,t){return t.length-e.length}}class r{}class n extends r{transform(e,r){const n=[...e.matchAll(/--[\w-]+(?=\s*: *.+(;|[\n\s]*}))/g),...e.matchAll(/(?<=@property )--[\w-]+(?=\s*{[^{}]*})/g)];let s=0;for(const o of n){const n=o[0],a=o.index+s,l=r.transform(n),i=t.replaceRange(e,a,a+n.length,`--${l}`);s+=t.replacedLength(e,i),e=i}return e}}class s extends r{transform(e,r){const n=/((:|::)\w+(\([\w='"]+\))?)?/.source,s=`${`${/(\.|#)[a-zA-Z0-9_-]+/.source}${n}`}(?=(${`\\s+(\\w*(${`${/(\.|#)?[a-zA-Z0-0_-]+/.source}${n}`})?)\\s*`})*\\{)`,o=e.matchAll(new RegExp(s,"g"));let a=0;for(const n of o){const s=n[0],o=/^\./.test(s),l=(o?r.classMangler:r.idMangler).transform(s),i=s.length,c=o?".":"#",u=n.index+a,h=t.replaceRange(e,u,u+i,c+l);a+=t.replacedLength(e,h),e=h}return e}}class o{}class a extends o{constructor(e){super(),this.options=e}transform(e,t){const r=this.options.literals?this.transformLiteral(e,t):e;return this.options.property?this.transformProperty(r,t):r}transformLiteral(e,r){const n=e.matchAll(/(?<="|')--[\w-]+(?=\\?\"|')/g);let s=0;for(const o of n){const n=o[0],a=o.index+s,l=r.CSSVariableOf(n);if(l){const r=t.replaceRange(e,a,a+n.length,l);s+=t.replacedLength(e,r),e=r}}return e}transformProperty(e,r){const n=e.matchAll(/(?<=var\()[^()]*(?:\([^\)]*\)[^()]*)*(?=\))/g);let s=0;for(const o of n){const n=o[0].matchAll(/--[\w-]+/g),a=o.index;for(const o of n){const n=o[0],l=a+o.index+s,i=r.CSSVariableOf(n);if(i){const r=t.replaceRange(e,l,l+n.length,i);s+=t.replacedLength(e,r),e=r}}}return e}}class l extends o{transform(e,t){return e}}class i{}class c extends i{constructor(){super(...arguments),this.manglers=[]}createMangler(){const t=new e;return this.manglers.push(t),t}}class u extends c{constructor(e){super(),this.options=e}createManglerDeclaration(){return new n}createManglerReference(){return new a(this.options)}transform(e){var t;const r=null!==(t=this.manglers[0])&&void 0!==t?t:this.createMangler(),n=this.createManglerDeclaration().transform(e,r);return this.createManglerReference().transform(n,r)}}class h extends c{createManglerDeclaration(){return new s}createManglerReference(){return new l}transform(e){var t,r;const n={classMangler:null!==(t=this.manglers[0])&&void 0!==t?t:this.createMangler(),idMangler:null!==(r=this.manglers[1])&&void 0!==r?r:this.createMangler()},s=this.createManglerDeclaration().transform(e,n);return this.createManglerReference().transform(s,n)}}class g{constructor(e){var t,r,n,s,o,a,l,i,c;if(this.options=e,this.transpilers=[],null!==(t=null==e?void 0:e.mangle)&&void 0!==t&&!t)return;const g=null===(n=null===(r=null==e?void 0:e.mangle)||void 0===r?void 0:r.variableName)||void 0===n||n,d=null!==(o=null===(s=null==e?void 0:e.mangle)||void 0===s?void 0:s.className)&&void 0!==o&&o,p=null!==(l=null===(a=null==e?void 0:e.mangle)||void 0===a?void 0:a.idName)&&void 0!==l&&l;!0!==g&&null==g.property&&null==g.literals||this.transpilers.push(new u({property:null===(i=g.property)||void 0===i||i,literals:null===(c=g.literals)||void 0===c||c})),(null!=d&&d||null!=p&&p)&&this.transpilers.push(new h)}apply(e){var t,r,n,s,o,a;const l=!(null!==(r=null===(t=this.options)||void 0===t?void 0:t.ignoreScript)&&void 0!==r&&r),i=null!==(s=null===(n=this.options)||void 0===n?void 0:n.processStage)&&void 0!==s?s:"OPTIMIZE_INLINE",c=null!==(a=null===(o=this.options)||void 0===o?void 0:o.reserved)&&void 0!==a?a:[];e.hooks.compilation.tap("CSSMangleWebpackPlugin",(t=>{t.hooks.processAssets.tap({name:"CSSMangleWebpackPlugin",stage:"OPTIMIZE_INLINE"==i?e.webpack.Compilation.PROCESS_ASSETS_STAGE_OPTIMIZE_INLINE:e.webpack.Compilation.PROCESS_ASSETS_STAGE_OPTIMIZE},(r=>{var n,s,o,a;for(const n in r){if(c.find((e=>e==n)))return;if(n.endsWith(".html")||n.endsWith(".js")&&l||n.endsWith(".jsx")&&l||n.endsWith(".css"))for(const s of this.transpilers){const o=r[n].source().toString();t.updateAsset(n,new e.webpack.sources.RawSource(s.transform(o)))}}null!==(s="ALL"==(null===(n=this.options)||void 0===n?void 0:n.printLogs))&&void 0!==s&&s&&this.transpilers.forEach((e=>e.manglers.forEach((e=>e.printLogs())))),null!==(a="WARNING"==(null===(o=this.options)||void 0===o?void 0:o.printLogs))&&void 0!==a&&a&&this.transpilers.forEach((e=>e.manglers.forEach((e=>e.printLogsUnused()))))}))}))}}export{n as CSSVariableDeclaration,a as CSSVariableReference,e as Mangler,r as ManglerDeclaration,o as ManglerReference,i as ManglerTranspiler,g as default};
