!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).CSSMangleWebpackPlugin={})}(this,(function(e){"use strict";var t,n;class r{constructor(){this.count=0,this.cache=new Map}createIdentifierName(e=this.count++){let n="",r=t.letterCases.length;for(;e>=0&&(n=t.letterCases[e%r]+n,e>0);)e=Math.floor(e/r)-1;return n}transform(e){let t=this.cache.get(e);return t?(t.referenceCount+=1,t.identifierName):(this.cache.set(e,{originalName:e,identifierName:this.createIdentifierName(),referenceCount:0}),this.cache.get(e).identifierName)}get unused(){return Array.from(this.cache.values()).filter((e=>0==e.referenceCount))}CSSVariableOf(e,t=!1){return this.cache.get(e)||t?`--${this.transform(e)}`:null}CSSPropertyOf(e,t){return this.cache.get(e=t+e)?`${t}${this.transform(e)}`:null}printLogs(){console.log(this.cache)}printLogsUnused(){for(const e of this.unused)console.log(`${e.originalName} is not referenced.`)}}t=r,r.lowerCases="abcdefghijklmnopqrstuvwxyz",r.upperCases="ABCDEFGHIJKLMNOPQRSTUVWXYZ",r.letterCases=t.lowerCases+t.upperCases;class s{constructor(e,t){this.options=e,this.parent=t}}class a{static replaceRange(e,t,n,r){return e.substring(0,t)+r+e.substring(n)}static replacedLength(e,t){return t.length-e.length}}class o{}class l extends o{transform(e,t){const n=[...e.syntaxText.matchAll(/--[\w-]+(?=\s*: *.+(;|[\n\s]*}))/g),...e.syntaxText.matchAll(/(?<=@property )--[\w-]+(?=\s*{[^{}]*})/g)];let r=0,s=e.syntaxText;for(const e of n){const n=e[0],o=e.index+r,l=t.parent.transform(n),i=a.replaceRange(s,o,o+n.length,`--${l}`);r+=a.replacedLength(s,i),s=i}return s}}class i extends o{transform(e,t){const n=/((:|::)(?!function\b)[\w-]+([\(\[][\w-]+([~|^$*]?=((".*?")|('.*?')|\d+)(\s[is])?)?[\)\]])?)?/.source,r=`${/([\w-]*(\.|#)?[a-zA-Z0-9_-]+|\*)/.source}${n}`,s=`${`${/(\.|#)[a-zA-Z0-9_-]+/.source}${n}`}(?=\\s*?{|${`((\\s+?${r})|(\\s*?${/[>+~,]/.source}\\s*?${r}))+?`}\\s*?{)`,o=e.syntaxText.matchAll(/(\.|\#)\w+[^]*?{/g);let l=0,i=e.syntaxText;for(const e of o){const n=e[0].matchAll(new RegExp(s,"g"));for(const r of n){const n=r[0],s=/^\./.test(n),o=t.parent,c=(s?o.classMangler:o.idMangler).transform(n),d=n.length,u=s?".":"#",p=e.index+r.index+l,h=a.replaceRange(i,p,p+d,u+c);l+=a.replacedLength(i,h),i=h}}return i}}class c{}class d extends c{constructor(e){super(),this.options=e}transform(e,t){const n=this.options.literals?this.transformLiteral(e.syntaxText,t):e.syntaxText;return this.options.property?this.transformProperty(n,t):n}transformLiteral(e,t){const n=e.matchAll(/(?<="|')--[\w-]+(?=\\?\"|')/g);let r=0;for(const s of n){const n=s.index+r,o=t.parent,l=s[0],i=o.CSSVariableOf(l,t.options.canUndeclared);if(i){const t=a.replaceRange(e,n,n+l.length,i);r+=a.replacedLength(e,t),e=t}}return e}transformProperty(e,t){const n=e.matchAll(/(?<=var\()[^()]*(?:\([^\)]*\)[^()]*)*(?=\))/g);let r=0;for(const s of n){const n=s[0].matchAll(/--[\w-]+/g),o=s.index;for(const s of n){const n=o+s.index+r,l=t.parent,i=s[0],c=l.CSSVariableOf(i,t.options.canUndeclared);if(c){const t=a.replaceRange(e,n,n+i.length,c);r+=a.replacedLength(e,t),e=t}}}return e}}class u extends c{transform(e,t){const n=this.transformHTML(e.syntaxText,t);return this.transformObject(n,t)}transformHTML(e,t){const n=e=>new RegExp(`(?<=<[\\w-]+ .*${e}\\s*=\\s*")[\\w\\s-]+(?=".*>)`,"g"),r=e.matchAll(n("class")),s=e.matchAll(n("id")),o=t.parent,l=(e,t,n)=>({name:e[0],index:e.index,prefix:t,mangler:n}),i=[...Array.from(r).map((e=>l(e,".",o.classMangler))),...Array.from(s).map((e=>l(e,"#",o.idMangler)))];for(const t of i){const n=t.name.matchAll(/[\w-]+/g),r=t.index;let s=0;for(const o of n){const n=o[0],l=t.mangler.CSSPropertyOf(n,t.prefix),i=n.length,c=r+o.index+s;if(l){const n=a.replaceRange(e,c,c+i,l.replace(t.prefix,""));s+=a.replacedLength(e,n),e=n}}}return e}transformObject(e,t){const n=e=>new RegExp(`(?<=\\{.*${e}:\\s*['"])[\\w\\s-]+(?=['"].*\\})`,"g"),r=e.matchAll(n("className"));e.matchAll(n("id"));for(const e of r)console.log(e[0]);return e}}class p{}class h extends p{createMangler(){return new r}}class f extends h{constructor(e){super(),this.options=e}createManglerDeclaration(){return new l}createManglerReference(){return new d(this.options)}createContext(){return new s(this.options,this.createMangler())}transform(e){var t;const n=null!==(t=this.context)&&void 0!==t?t:this.createContext(),r=this.createManglerDeclaration().transform(e,n);return this.createManglerReference().transform((e.syntaxText=r,e),n)}}class g extends h{createManglerDeclaration(){return new i}createManglerReference(){return new u}createContext(){return new s({reversed:[],canUndeclared:!1},{classMangler:this.createMangler(),idMangler:this.createMangler()})}transform(e){var t;const n=null!==(t=this.context)&&void 0!==t?t:this.createContext(),r=this.createManglerDeclaration().transform(e,n);return this.createManglerReference().transform((e.syntaxText=r,e),n)}}!function(e){e.SCRIPT="script",e.HTML4="html",e.STYLE="style",e.OTHER="other"}(n||(n={}));class m{static assetTypeOf(e){return e.endsWith(".js")||e.endsWith(".jsx")?n.SCRIPT:e.endsWith(".css")?n.STYLE:e.endsWith(".html")?n.HTML4:n.OTHER}}e.CSSVariableDeclaration=l,e.CSSVariableReference=d,e.Mangler=r,e.ManglerDeclaration=o,e.ManglerReference=c,e.ManglerTranspiler=p,e.default=class{constructor(e){var t,n,r,s,a,o,l,i,c,d,u,p;if(this.options=e,this.transpilers=[],null!==(t=null==e?void 0:e.mangle)&&void 0!==t&&!t)return;const h=null===(r=null===(n=null==e?void 0:e.mangle)||void 0===n?void 0:n.variableName)||void 0===r||r,m=null!==(a=null===(s=null==e?void 0:e.mangle)||void 0===s?void 0:s.className)&&void 0!==a&&a,x=null!==(l=null===(o=null==e?void 0:e.mangle)||void 0===o?void 0:o.idName)&&void 0!==l&&l,v=null!==(d=null===(c=null===(i=null==e?void 0:e.mangle)||void 0===i?void 0:i.options)||void 0===c?void 0:c.undeclared)&&void 0!==d&&d;!0!==h&&null==h.property&&null==h.literals||this.transpilers.push(new f({reversed:[],canUndeclared:v,property:null===(u=h.property)||void 0===u||u,literals:null===(p=h.literals)||void 0===p||p})),(null!=m&&m||null!=x&&x)&&this.transpilers.push(new g)}apply(e){var t,n,r,s,a,o;const l=!(null!==(n=null===(t=this.options)||void 0===t?void 0:t.ignoreScript)&&void 0!==n&&n),i=null!==(s=null===(r=this.options)||void 0===r?void 0:r.processStage)&&void 0!==s?s:"OPTIMIZE_INLINE",c=null!==(o=null===(a=this.options)||void 0===a?void 0:a.reserved)&&void 0!==o?o:[];e.hooks.compilation.tap("CSSMangleWebpackPlugin",(t=>{t.hooks.processAssets.tap({name:"CSSMangleWebpackPlugin",stage:"OPTIMIZE_INLINE"==i?e.webpack.Compilation.PROCESS_ASSETS_STAGE_OPTIMIZE_INLINE:e.webpack.Compilation.PROCESS_ASSETS_STAGE_OPTIMIZE},(n=>{var r,s,a,o;for(const r in n){if(c.find((e=>e==r)))return;if(r.endsWith(".html")||r.endsWith(".js")&&l||r.endsWith(".jsx")&&l||r.endsWith(".css"))for(const s of this.transpilers){const a=n[r].source().toString();t.updateAsset(r,new e.webpack.sources.RawSource(s.transform({syntaxText:a,syntaxType:m.assetTypeOf(r)})))}}null!==(s="ALL"==(null===(r=this.options)||void 0===r?void 0:r.printLogs))&&void 0!==s&&s&&this.transpilers.forEach((e=>e.context.parent.forEach((e=>e.printLogs())))),null!==(o="WARNING"==(null===(a=this.options)||void 0===a?void 0:a.printLogs))&&void 0!==o&&o&&this.transpilers.forEach((e=>e.context.parent.forEach((e=>e.printLogsUnused()))))}))}))}},Object.defineProperty(e,"__esModule",{value:!0})}));
