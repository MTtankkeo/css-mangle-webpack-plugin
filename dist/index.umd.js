!function(e,n){"object"==typeof exports&&"undefined"!=typeof module?n(exports):"function"==typeof define&&define.amd?define(["exports"],n):n((e="undefined"!=typeof globalThis?globalThis:e||self).CSSMangleWebpackPlugin={})}(this,(function(e){"use strict";class n{static replaceRange(e,n,t,s){return e.substring(0,n)+s+e.substring(t)}}class t{}class s extends t{transform(e,t){const s=e.matchAll(/--[\w-]+(?=\s*: ?.+;)/g);let r=0;for(const a of s){const s=a[0],o=a.index-r,i=t.transform(s),l=n.replaceRange(e,o,o+s.length,`--${i}`);r+=e.length-l.length,e=l}return e}}class r{}class a extends r{transform(e,t){const s=e.matchAll(/(?<="|')--[\w-]+(?=\\?\"|')/g),r=e.matchAll(/(?<=var\()[^()]*(?:\([^\)]*\)[^()]*)*(?=\))/g);let a=0;for(const r of s){const s=r[0],o=r.index-a,i=n.replaceRange(e,o,o+s.length,t.CSSVariableOf(s));a+=e.length-i.length,e=i}for(const s of r){const r=s[0].matchAll(/--[\w-]+/g),o=s.index;for(const s of r){const r=s[0],i=o+s.index-a,l=n.replaceRange(e,i,i+r.length,t.CSSVariableOf(r));a+=e.length-l.length,e=l}}return e}}class o{constructor(){this.count=0,this.chars="abcdefghijklmnopqrstuvwxyz",this.cache=new Map}createName(e=this.count++){let n="",t=this.chars.length;for(;e>=0&&(n=this.chars[e%t]+n,e>0);)e=Math.floor(e/t)-1;return n}transform(e){let n=this.cache.get(e);return n?(n.referenceCount+=1,n.identifierName):(this.cache.set(e,{originName:e,identifierName:this.createName(),referenceCount:0}),this.cache.get(e).identifierName)}CSSVariableOf(e){return this.cache.get(e)?`--${this.transform(e)}`:e}printLogs(){console.log(this.cache)}printLogsUnused(){for(const e of this.cache.values())0==e.referenceCount&&console.log(`${e.originName} is not referenced.`)}}e.CSSVariableDeclaration=s,e.CSSVariableReference=a,e.Mangler=o,e.ManglerDeclaration=t,e.ManglerReference=r,e.default=class{constructor(e){var n,t;this.options=e,this.transpilers=[],(null===(t=null===(n=null==e?void 0:e.mangle)||void 0===n?void 0:n.variable)||void 0===t||t)&&this.transpilers.push({declaration:new s,reference:new a,mangler:new o})}apply(e){e.hooks.compilation.tap("CSSMangleWebpackPlugin",(n=>{n.hooks.processAssets.tap({name:"CSSMangleWebpackPlugin",stage:e.webpack.Compilation.PROCESS_ASSETS_STAGE_OPTIMIZE},(t=>{var s,r,a,o;for(const s in t)if(s.endsWith(".html")||s.endsWith(".js")||s.endsWith(".jsx")||s.endsWith(".css"))for(const r of this.transpilers){const a=t[s].source().toString(),o=r.declaration.transform(a,r.mangler),i=r.reference.transform(o,r.mangler);n.updateAsset(s,new e.webpack.sources.RawSource(i))}null!==(r="all"==(null===(s=this.options)||void 0===s?void 0:s.printLogs))&&void 0!==r&&r&&this.transpilers.forEach((e=>e.mangler.printLogs())),null!==(o="warning"==(null===(a=this.options)||void 0===a?void 0:a.printLogs))&&void 0!==o&&o&&this.transpilers.forEach((e=>e.mangler.printLogsUnused()))}))}))}},Object.defineProperty(e,"__esModule",{value:!0})}));
