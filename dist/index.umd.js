!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).CSSMangleWebpackPlugin={})}(this,(function(e){"use strict";class t{constructor(){this.count=0,this.cache=new Map}createIdentifierName(e=this.count++){let n="",r=t.chars.length;for(;e>=0&&(n=t.chars[e%r]+n,e>0);)e=Math.floor(e/r)-1;return n}transform(e){let t=this.cache.get(e);return t?(t.referenceCount+=1,t.identifierName):(this.cache.set(e,{originalName:e,identifierName:this.createIdentifierName(),referenceCount:0}),this.cache.get(e).identifierName)}get unused(){return Array.from(this.cache.values()).filter((e=>0==e.referenceCount))}CSSVariableOf(e){return this.cache.get(e)?`--${this.transform(e)}`:null}printLogs(){console.log(this.cache)}printLogsUnused(){for(const e of this.unused)console.log(`${e.originalName} is not referenced.`)}}t.chars="abcdefghijklmnopqrstuvwxyz";class n{static replaceRange(e,t,n,r){return e.substring(0,t)+r+e.substring(n)}static replacedLength(e,t){return t.length-e.length}}class r{}class s extends r{transform(e,t){const r=[...e.matchAll(/--[\w-]+(?=\s*: *.+(;|[\n\s]*}))/g),...e.matchAll(/(?<=@property )--[\w-]+(?=\s*{[^{}]*})/g)];let s=0;for(const a of r){const r=a[0],o=a.index+s,l=t.transform(r),i=n.replaceRange(e,o,o+r.length,`--${l}`);s+=n.replacedLength(e,i),e=i}return e}}class a extends r{transform(e,t){const r=/((:|::)\w+(\([\w='"]+\))?)?/.source,s=`${`${/(\.|#)[a-zA-Z0-9_-]+/.source}${r}`}(?=(${`\\s+(\\w*(${`${/(\.|#)?[a-zA-Z0-0_-]+/.source}${r}`})?)\\s*`})*\\{)`,a=e.matchAll(new RegExp(s,"g"));let o=0;for(const r of a){const s=r[0],a=/^\./.test(s),l=(a?t.classMangler:t.idMangler).transform(s),i=s.length,c=a?".":"#",u=r.index+o,h=n.replaceRange(e,u,u+i,c+l);o+=n.replacedLength(e,h),e=h}return e}}class o{}class l extends o{constructor(e){super(),this.options=e}transform(e,t){const n=this.options.literals?this.transformLiteral(e,t):e;return this.options.property?this.transformProperty(n,t):n}transformLiteral(e,t){const r=e.matchAll(/(?<="|')--[\w-]+(?=\\?\"|')/g);let s=0;for(const a of r){const r=a[0],o=a.index+s,l=t.CSSVariableOf(r);if(l){const t=n.replaceRange(e,o,o+r.length,l);s+=n.replacedLength(e,t),e=t}}return e}transformProperty(e,t){const r=e.matchAll(/(?<=var\()[^()]*(?:\([^\)]*\)[^()]*)*(?=\))/g);let s=0;for(const a of r){const r=a[0].matchAll(/--[\w-]+/g),o=a.index;for(const a of r){const r=a[0],l=o+a.index+s,i=t.CSSVariableOf(r);if(i){const t=n.replaceRange(e,l,l+r.length,i);s+=n.replacedLength(e,t),e=t}}}return e}}class i extends o{transform(e,t){return e}}class c{}class u extends c{constructor(){super(...arguments),this.manglers=[]}createMangler(){const e=new t;return this.manglers.push(e),e}}class h extends u{constructor(e){super(),this.options=e}createManglerDeclaration(){return new s}createManglerReference(){return new l(this.options)}transform(e){var t;const n=null!==(t=this.manglers[0])&&void 0!==t?t:this.createMangler(),r=this.createManglerDeclaration().transform(e,n);return this.createManglerReference().transform(r,n)}}class d extends u{createManglerDeclaration(){return new a}createManglerReference(){return new i}transform(e){var t,n;const r={classMangler:null!==(t=this.manglers[0])&&void 0!==t?t:this.createMangler(),idMangler:null!==(n=this.manglers[1])&&void 0!==n?n:this.createMangler()},s=this.createManglerDeclaration().transform(e,r);return this.createManglerReference().transform(s,r)}}e.CSSVariableDeclaration=s,e.CSSVariableReference=l,e.Mangler=t,e.ManglerDeclaration=r,e.ManglerReference=o,e.ManglerTranspiler=c,e.default=class{constructor(e){var t,n,r,s,a,o,l,i,c;if(this.options=e,this.transpilers=[],null!==(t=null==e?void 0:e.mangle)&&void 0!==t&&!t)return;const u=null===(r=null===(n=null==e?void 0:e.mangle)||void 0===n?void 0:n.variableName)||void 0===r||r,g=null!==(a=null===(s=null==e?void 0:e.mangle)||void 0===s?void 0:s.className)&&void 0!==a&&a,f=null!==(l=null===(o=null==e?void 0:e.mangle)||void 0===o?void 0:o.idName)&&void 0!==l&&l;!0!==u&&null==u.property&&null==u.literals||this.transpilers.push(new h({property:null===(i=u.property)||void 0===i||i,literals:null===(c=u.literals)||void 0===c||c})),(null!=g&&g||null!=f&&f)&&this.transpilers.push(new d)}apply(e){var t,n,r,s,a,o;const l=!(null!==(n=null===(t=this.options)||void 0===t?void 0:t.ignoreScript)&&void 0!==n&&n),i=null!==(s=null===(r=this.options)||void 0===r?void 0:r.processStage)&&void 0!==s?s:"OPTIMIZE_INLINE",c=null!==(o=null===(a=this.options)||void 0===a?void 0:a.reserved)&&void 0!==o?o:[];e.hooks.compilation.tap("CSSMangleWebpackPlugin",(t=>{t.hooks.processAssets.tap({name:"CSSMangleWebpackPlugin",stage:"OPTIMIZE_INLINE"==i?e.webpack.Compilation.PROCESS_ASSETS_STAGE_OPTIMIZE_INLINE:e.webpack.Compilation.PROCESS_ASSETS_STAGE_OPTIMIZE},(n=>{var r,s,a,o;for(const r in n){if(c.find((e=>e==r)))return;if(r.endsWith(".html")||r.endsWith(".js")&&l||r.endsWith(".jsx")&&l||r.endsWith(".css"))for(const s of this.transpilers){const a=n[r].source().toString();t.updateAsset(r,new e.webpack.sources.RawSource(s.transform(a)))}}null!==(s="ALL"==(null===(r=this.options)||void 0===r?void 0:r.printLogs))&&void 0!==s&&s&&this.transpilers.forEach((e=>e.manglers.forEach((e=>e.printLogs())))),null!==(o="WARNING"==(null===(a=this.options)||void 0===a?void 0:a.printLogs))&&void 0!==o&&o&&this.transpilers.forEach((e=>e.manglers.forEach((e=>e.printLogsUnused()))))}))}))}},Object.defineProperty(e,"__esModule",{value:!0})}));
